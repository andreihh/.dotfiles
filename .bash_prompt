# ~/.bash_prompt: this file customizes the shell prompt.

_config_prompt() {
  # Set variable identifying the chroot you work in (used in the prompt below).
  if [ -z "${debian_chroot:-}" ] && [ -r /etc/debian_chroot ]; then
    debian_chroot=$(cat /etc/debian_chroot)
  fi

  # Set a fancy prompt.
  local color_prompt=
  case "$TERM" in
    xterm-color | *-256color) color_prompt=yes ;;
  esac

  if [ -x /usr/bin/tput ] && tput setaf 1 >&/dev/null; then
    # We have color support; assume it's compliant with Ecma-48 (ISO/IEC-6429).
    # Lack of such support is extremely rare, and such a case would tend to
    # support setf rather than setaf.
    color_prompt=yes
  else
    color_prompt=
  fi

  # If colors are not supported, use the default prompt.
  if [ -z "$color_prompt" ]; then
    PS1='${debian_chroot:+($debian_chroot)}\u@\h:\w\$ '
    PS2='> '
    return
  fi

  # Define color and style aliases.
  local bold="\[\e[1m\]"

  local black="\[\e[30m\]"
  local red="\[\e[31m\]"
  local green="\[\e[32m\]"
  local yellow="\[\e[33m\]"
  local blue="\[\e[34m\]"
  local purple="\[\e[35m\]"
  local cyan="\[\e[36m\]"
  local white="\[\e[37m\]"
  local bright_red="\[\e[91m\]"

  local reset_style="\[\e[0m\]"

  local user_style="$bold$red"
  if [ "$USER" == "root" ]; then
    user_style="$bold$bright_red"
  fi

  local host_style="$bold$cyan"
  local cwd_style="$bold$blue"
  local shell_style="$bold$green"

  # Print only the first 3 and last 2 components of the current working
  # directory (not counting `$HOME`, which is collapsed to `~`).
  local cwd='`dirs +0 | sed "s#\(/[^/]\{1,\}/[^/]\{1,\}/[^/]\{1,\}/\).*\(/[^/]\{1,\}/[^/]\{1,\}\)/\{0,1\}#\1...\2#g"`'

  # Set the terminal prompt.
  PS1="${debian_chroot:+($debian_chroot)}"
  PS1+="${user_style}\u" # set user
  if [ -n "$SSH_TTY" ]; then
    PS1+="${shell_style}@${host_style}\h" # set `@` and host if remote session
  fi
  PS1+="${shell_style}:" # set `:` separator
  PS1+="${cwd_style}$cwd" # set current working directory
  PS1+="${shell_style}\$ " # set shell
  PS1+="${reset_style}" # reset style

  PS2="${shell_style}> ${reset_style}" # set shell and reset style

  # If this is an xterm, set the title to user@host:dir.
  case "$TERM" in
    xterm* | rxvt*)
      PS1="\[\e]0;${debian_chroot:+($debian_chroot)}\u@\h: \W\a\]$PS1"
      ;;
    *) ;;
  esac

  echo -ne '\e]10;#a9b7c6\e\\' # set foreground to match Darcula
  echo -ne '\e]11;#262626\e\\' # set background to match Darcula
}

_config_prompt
