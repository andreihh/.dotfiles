" .ideavimrc

" ------------------------------
" Shared settings with ~/.vimrc.
" ------------------------------

" This option stops Vim from behaving in a strongly Vi -compatible way.
set nocompatible

" When set, highlights the current line.
set cursorline

" Highlight when you exceed the 101 column limit.
set colorcolumn=101

" When wrap is set to off lines will not wrap.
set nowrap

" Show the line and column number of the cursor position.
set ruler

" Show command in the last line of the screen.
set showcmd

" Show current mode.
set showmode

" When a bracket is inserted, briefly jump to the matching one.
set showmatch

" Print relative line numbers in front of each line.
set relativenumber

" Print the absolute line number in front of the current line.
set number

" Search options:
" - hlsearch: When there is a previous search pattern, highlight all its
" matches.
" - ignorecase: Ignore case in search patterns.
" - incsearch: While typing a search command, show where the pattern, as it was
" typed so far, matches.
set hlsearch ignorecase incsearch

" When set, enables syntax highlighting.
syntax enable

" Allow backspacing over audoindent, line breaks and the start of insert.
set backspace=indent,eol,start

" When increasing/decreasing indent level, round to nearest multiple of
" shiftwidth.
set shiftround

" Copy indent from current line when starting a new line.
set autoindent

" Do smart autoindenting when starting a new line.
set smartindent

" Always assume unix-style files.
set fileformats=unix

" Highlight tabs and trailing whitespaces at the end of line.
set list listchars=tab:>-,trail:.,nbsp:~

" Open new split panes to right and bottom, which feels more natural.
set splitbelow
set splitright

" Copy until the end of the line. Consistent with D and C.
nnoremap Y y$

" Cancels search highlighting in normal mode.
nnoremap <Space>/ :nohlsearch<CR><Esc>

" ----------------------------
" Custom settings for IdeaVIM.
" ----------------------------

" Enable vim-surround plugin.
set surround

" Enable NERDTree plugin.
set NERDTree

" Enable ideajoin plugin.
set ideajoin

" Enable using the system clipboard from IdeaVIM and vice-versa.
set clipboard+=unnamed
set clipboard+=ideaput

" IDE actions.
" Ideally, these should all be noremap, but that's not currently supported.

" Cycle through completion menu with <C-n> and <C-p>.
" Currently, this is not supported by IdeaVIM, and the EditorDown/Up actions
" don't work as expected.
"imap <C-n> <Action>(EditorDown)
"imap <C-p> <Action>(EditorUp)

" Common, navigation, and code manipulation actions.
nmap <Space>f <Action>(FindUsages)
nmap <Space>q <Action>(QuickJavaDoc)
nmap <Space>p <Action>(ParameterInfo)
nmap <Space>r <Action>(RenameElement)
nmap <Space>R <Action>(RefactoringMenu)
nmap <Space>m <Action>(Move)
nmap <Space>d <Action>(GotoDeclaration)
nmap <Space>g <Action>(GotoImplementation)
nmap <Space>s <Action>(GotoSuperMethod)
nmap <Space>j <Action>(Back)
nmap <Space>k <Action>(Forward)
nmap <Space>o <Action>(OptimizeImports)
nmap <Space>= <Action>(ReformatCode)
nmap <Space>n <Action>(ShowNavBar)
nmap <Space>i <Action>(NewElement)
nmap <Space>x <Action>(RunAnything)
nmap <Space><Space> <Action>(SearchEverywhere)
nmap [m <Action>(MethodUp)
nmap ]m <Action>(MethodDown)
nmap <Tab> <Action>(NextTab)
nmap <S-Tab> <Action>(PreviousTab)

" These actions must work in insert mode as well.
nmap <A-CR> <Action>(ShowIntentionActions)
nmap <C-Space> <Action>(SmartTypeCompletion)
" Currently, IdeaVIM doesn't properly return to insert mode when using the
" <Action>() syntax.
imap <A-CR> <C-o>:action ShowIntentionActions<CR>
imap <C-Space> <C-o>:action SmartTypeCompletion<CR>

" Tool window actions.
nnoremap <A-1> :NERDTree<CR>
nmap <A-2> <Action>(ActivateStructureToolWindow)
nmap <A-3> <Action>(ActivateTerminalToolWindow)
nmap <A-4> <Action>(ActivateFindToolWindow)
nmap <A-5> <Action>(ActivateVersionControlToolWindow)
nmap <A-8> <Action>(ActivateRunToolWindow)
nmap <A-9> <Action>(ActivateDebugToolWindow)
nmap <A-Esc> <Action>(HideAllWindows)
nmap <F11> <Action>(ToggleFullScreen)

" Debugging actions.
nmap <F1> <Action>(ToggleLineBreakpoint)
nmap <F2> <Action>(ShowExecutionPoint)
nmap <F3> <Action>(StepOver)
nmap <F4> <Action>(StepInto)
nmap <F5> <Action>(StepOut)
nmap <F6> <Action>(RunToCursor)
nmap <F7> <Action>(EvaluateExpression)
nmap <F8> <Action>(Resume)
nmap <F9> <Action>(Stop)
nmap <F10> <Action>(ViewBreakpoints)

" IdeaVIM doesn't work when focusing tool windows, so their shortcuts (except
" ActivateProjectToolWindow) need to be overridden in the IDE keymap as well:
" - Keymap > Main Menu > Window > Active Tool Window > Hide All Tool Windows
" - Keymap > Tool Windows > ...

" Other keymaps:
" - Editor actions:
"   - Down: Ctrl-n
"   - Up: Ctrl-p
" - Main menu:
"   - Edit:
"     - Copy: Ctrl-c
"     - Cut: Ctrl-x
"     - Delete: Delete
"     - Paste: Ctrl-v
"
" Other settings:
" - View:
"   - Active Editor:
"     - Show Breadcrumbs: off
"   - Tool Buttons: off, bring back temporarily with Alt-Alt
"   - Toolbar: off
"   - Status Bar: on
"   - Navigation Bar: off
" - Editor:
"   - General:
"     - Editor Tabs:
"       - Placement: None
" - Tools:
"   - Terminal:
"     - Override IDE shortcuts: on
" - Tool Buttons:
"   - All tool windows except Favorites, Event Log and TODO have Split Mode off
"   - Placement:
"     - Left: Project, Structure, Favorites
"     - Bottom: Terminal, Find, Version Control, Run, Debug, TODO, Event Log
